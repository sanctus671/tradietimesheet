(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{o9FT:function(n,t,s){"use strict";s.r(t);var i=s("CcnG"),l=function(){return function(){}}(),e=s("pMnS"),u=s("oBZk"),o=s("ZZ/e"),r=s("ZYCi"),a=s("Ip0R"),b=s("QaJk"),m=s("ri4K"),c=s("wd/R"),f=function(){function n(n,t,s,i,l,e,u,o){var r=this;this.submissionService=n,this.toastController=t,this.modalController=s,this.router=i,this.authenticationService=l,this.alertCtrl=e,this.ngZone=u,this.platform=o,this.appSettings={name:"",color_scheme:"",logo:"",field_labels:"",week_start:"",break_toggle:!1},this.loading=!0,this.submissions=[],this.submittedSubmissions=[],this.weeks=[],this.submissionsByWeek={},this.workTimeByWeek={},this.breakTime=30,this.user={},this.authenticationService.getUserData().subscribe((function(n){if(r.ngZone.run((function(){r.user=n})),r.user.groups.length>0){var t=r.user.groups[0];r.appSettings=r.user.groups[0],r.ngZone.run((function(){t.break_time&&(r.breakTime=parseFloat(t.break_time))}))}r.weeks=[],r.submissionsByWeek={},r.getSubmissions(),r.getSubmittedSubmissions()}))}return n.prototype.ngOnInit=function(){},n.prototype.ionViewDidEnter=function(){this.weeks=[],this.submissionsByWeek={},this.getSubmissions(),this.getSubmittedSubmissions()},n.prototype.getSubmissions=function(){var n=this;this.submissionService.getLocalSubmissions().then((function(t){n.submissions=t;for(var s=n.appSettings.week_start?n.appSettings.week_start:"Monday",i=0,l=n.submissions;i<l.length;i++){var e=l[i],u=c(e.submission_date).startOf("week").day(s),o=c(e.submission_date);u.isAfter(o)&&u.subtract(1,"weeks");var r=c(u).format("YYYY-MM-DD");n.weeks.indexOf(r)<0&&(n.weeks.push(r),n.submissionsByWeek[r]=[]);for(var a=!1,b=0,m=n.submissionsByWeek[r];b<m.length;b++)m[b].submission_date===e.submission_date&&(a=!0);a||n.submissionsByWeek[r].push(e),n.submissionsByWeek[r].sort((function(n,t){return new Date(n.submission_date)-new Date(t.submission_date)}))}n.weeks.sort((function(n,t){var s=new Date(n);return new Date(t)-s})),setTimeout((function(){n.loading=!1}),5e3)}))},n.prototype.getSubmittedSubmissions=function(){var n=this;this.submissionService.getSubmissions().then((function(t){n.submittedSubmissions=t;var s=n.appSettings.week_start?n.appSettings.week_start:"Monday";n.workTimeByWeek={};for(var i=0,l=n.submittedSubmissions;i<l.length;i++){var e=l[i],u=c(e.submission_date).startOf("week").day(s),o=c(e.submission_date);u.isAfter(o)&&u.subtract(1,"weeks");var r=c(u).format("YYYY-MM-DD");n.weeks.indexOf(r)<0&&(n.weeks.push(r),n.submissionsByWeek[r]=[]);for(var a=!1,b=0,m=n.submissionsByWeek[r];b<m.length;b++)m[b].submission_date===e.submission_date&&(a=!0);a||n.submissionsByWeek[r].push(e),n.submissionsByWeek[r].sort((function(n,t){return new Date(n.submission_date)-new Date(t.submission_date)}))}n.weeks.sort((function(n,t){var s=new Date(n);return new Date(t)-s})),n.loading=!1}))},n.prototype.calculateWorkTime=function(n){for(var t=0,s=0;s<8;s++){for(var i=c(n).add(s,"days").format("YYYY-MM-DD"),l=0,e=0,u=0,o=0,r=this.submissions;o<r.length;o++)if((f=r[o]).submission_date===i){var a=f.submission_date+" "+f.start_time;l+=c.duration(c(f.submission_date+" "+f.end_time).diff(c(a))).asMinutes(),f.no_break&&(e+=1),u+=1}for(var b=0,m=this.submittedSubmissions;b<m.length;b++){var f;(f=m[b]).submission_date===i&&(a=f.submission_date+" "+f.start_time,l+=c.duration(c(f.submission_date+" "+f.end_time).diff(c(a))).asMinutes(),f.no_break&&(e+=1),u+=1)}l>0&&(l-=this.breakTime,e>0&&u===e&&(l+=this.breakTime),l<0&&(l=0)),t+=l}return this.formatMinutes(t)},n.prototype.formatDate=function(n){return c(n).format("DD/MM/YYYY")},n.prototype.formatDatabase=function(n){return c(n).format("YYYY-MM-DD")},n.prototype.formatLongDate=function(n){return c(n).format("dddd Do MMM")},n.prototype.formatFromNow=function(n){return c(n).fromNow()},n.prototype.formatFromNowServer=function(n){var t=-(new Date).getTimezoneOffset();return c(n).add(t,"m").fromNow()},n.prototype.formatMinutes=function(n){var t=n/60,s=Math.floor(t),i=Math.round(60*(t-s));return(s>0?s+" "+(1===s?"hour":"hours")+" ":"")+(i>0?i+" "+(1===i?"minute":"minutes"):"")},n}(),p=i.rb({encapsulation:0,styles:[[".submissions[_ngcontent-%COMP%]   .submissions__list[_ngcontent-%COMP%]{margin-top:5px;margin-bottom:15px;border-bottom:1px solid #dedede;padding-bottom:40px}.submissions[_ngcontent-%COMP%]   .submissions__list[_ngcontent-%COMP%]   ion-list-header[_ngcontent-%COMP%]{font-weight:600;font-size:16px}.submissions[_ngcontent-%COMP%]   .submissions__list[_ngcontent-%COMP%]   .submissions__list__total[_ngcontent-%COMP%]{padding:0 15px;font-weight:700;margin-top:20px;font-size:14px}.submissions[_ngcontent-%COMP%]   .submissions__loading[_ngcontent-%COMP%]{text-align:center;margin-top:60px}"]],data:{}});function d(n){return i.Lb(0,[(n()(),i.tb(0,0,null,null,2,"div",[["class","submissions__loading"]],null,null,null,null,null)),(n()(),i.tb(1,0,null,null,1,"ion-spinner",[["color","primary"]],null,null,null,u.L,u.p)),i.sb(2,49152,null,0,o.sb,[i.h,i.k,i.z],{color:[0,"color"]},null)],(function(n,t){n(t,2,0,"primary")}),null)}function g(n){return i.Lb(0,[(n()(),i.tb(0,0,null,null,10,"div",[],null,null,null,null,null)),(n()(),i.tb(1,0,null,null,9,"ion-item",[["detail",""],["routerDirection","forward"]],null,[[null,"click"]],(function(n,t,s){var l=!0;return"click"===t&&(l=!1!==i.Eb(n,3).onClick()&&l),"click"===t&&(l=!1!==i.Eb(n,6).onClick(s)&&l),l}),u.H,u.l)),i.sb(2,49152,null,0,o.H,[i.h,i.k,i.z],{detail:[0,"detail"],routerDirection:[1,"routerDirection"]},null),i.sb(3,16384,null,0,r.n,[r.m,r.a,[8,null],i.D,i.k],{queryParams:[0,"queryParams"],routerLink:[1,"routerLink"]},null),i.Gb(4,{date:0}),i.Fb(5,1),i.sb(6,737280,null,0,o.Lb,[a.g,o.Ib,i.k,r.m,[2,r.n]],{routerDirection:[0,"routerDirection"]},null),(n()(),i.tb(7,0,null,0,3,"ion-label",[],null,null,null,u.I,u.m)),i.sb(8,49152,null,0,o.N,[i.h,i.k,i.z],null,null),(n()(),i.tb(9,0,null,0,1,"h2",[],null,null,null,null,null)),(n()(),i.Kb(10,null,["",""]))],(function(n,t){var s=t.component;n(t,2,0,"","forward");var i=n(t,4,0,s.formatDatabase(t.context.$implicit.submission_date)),l=n(t,5,0,"/timesheet-date");n(t,3,0,i,l),n(t,6,0,"forward")}),(function(n,t){n(t,10,0,t.component.formatLongDate(t.context.$implicit.submission_date))}))}function k(n){return i.Lb(0,[(n()(),i.tb(0,0,null,null,8,"ion-list",[["class","submissions__list"]],null,null,null,u.K,u.n)),i.sb(1,49152,null,0,o.O,[i.h,i.k,i.z],null,null),(n()(),i.tb(2,0,null,0,2,"ion-list-header",[],null,null,null,u.J,u.o)),i.sb(3,49152,null,0,o.P,[i.h,i.k,i.z],null,null),(n()(),i.Kb(4,0,[" Week of "," "])),(n()(),i.ib(16777216,null,0,1,null,g)),i.sb(6,278528,null,0,a.i,[i.O,i.L,i.s],{ngForOf:[0,"ngForOf"]},null),(n()(),i.tb(7,0,null,0,1,"div",[["class","submissions__list__total"]],null,null,null,null,null)),(n()(),i.Kb(8,null,[" Total work time is "," "]))],(function(n,t){n(t,6,0,t.component.submissionsByWeek[t.context.$implicit])}),(function(n,t){var s=t.component;n(t,4,0,s.formatDate(t.context.$implicit)),n(t,8,0,s.calculateWorkTime(t.context.$implicit))}))}function h(n){return i.Lb(0,[(n()(),i.tb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),i.ib(16777216,null,null,1,null,k)),i.sb(2,278528,null,0,a.i,[i.O,i.L,i.s],{ngForOf:[0,"ngForOf"]},null)],(function(n,t){n(t,2,0,t.component.weeks)}),null)}function _(n){return i.Lb(0,[(n()(),i.tb(0,0,null,null,6,"ion-header",[],null,null,null,u.E,u.i)),i.sb(1,49152,null,0,o.B,[i.h,i.k,i.z],null,null),(n()(),i.tb(2,0,null,0,4,"ion-toolbar",[["color","primary"]],null,null,null,u.R,u.v)),i.sb(3,49152,null,0,o.Cb,[i.h,i.k,i.z],{color:[0,"color"]},null),(n()(),i.tb(4,0,null,0,2,"ion-title",[],null,null,null,u.Q,u.u)),i.sb(5,49152,null,0,o.Ab,[i.h,i.k,i.z],null,null),(n()(),i.Kb(-1,0,[" Submissions "])),(n()(),i.tb(7,0,null,null,5,"ion-content",[["class","submissions"]],null,null,null,u.B,u.f)),i.sb(8,49152,null,0,o.u,[i.h,i.k,i.z],null,null),(n()(),i.ib(16777216,null,0,1,null,d)),i.sb(10,16384,null,0,a.j,[i.O,i.L],{ngIf:[0,"ngIf"]},null),(n()(),i.ib(16777216,null,0,1,null,h)),i.sb(12,16384,null,0,a.j,[i.O,i.L],{ngIf:[0,"ngIf"]},null)],(function(n,t){var s=t.component;n(t,3,0,"primary"),n(t,10,0,s.loading),n(t,12,0,!s.loading)}),null)}function w(n){return i.Lb(0,[(n()(),i.tb(0,0,null,null,1,"app-submissions",[],null,null,null,_,p)),i.sb(1,114688,null,0,f,[b.a,o.Ob,o.Hb,r.m,m.a,o.a,i.z,o.Jb],null,null)],(function(n,t){n(t,1,0)}),null)}var v=i.pb("app-submissions",f,w,{},{},[]),y=s("gIcY"),D=function(){return function(){}}();s.d(t,"SubmissionsPageModuleNgFactory",(function(){return M}));var M=i.qb(l,[],(function(n){return i.Bb([i.Cb(512,i.j,i.bb,[[8,[e.a,v]],[3,i.j],i.x]),i.Cb(4608,a.l,a.k,[i.u,[2,a.w]]),i.Cb(4608,y.j,y.j,[]),i.Cb(4608,o.b,o.b,[i.z,i.g]),i.Cb(4608,o.Hb,o.Hb,[o.b,i.j,i.q]),i.Cb(4608,o.Kb,o.Kb,[o.b,i.j,i.q]),i.Cb(1073742336,a.b,a.b,[]),i.Cb(1073742336,y.i,y.i,[]),i.Cb(1073742336,y.b,y.b,[]),i.Cb(1073742336,o.Eb,o.Eb,[]),i.Cb(1073742336,r.p,r.p,[[2,r.u],[2,r.m]]),i.Cb(1073742336,D,D,[]),i.Cb(1073742336,l,l,[]),i.Cb(1024,r.k,(function(){return[[{path:"",component:f}]]}),[])])}))}}]);